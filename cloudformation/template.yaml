Parameters:
  SSHKey:
    Type: AWS::EC2::KeyPair::KeyName
    Description: name of the key pair to ssh into the instance
Resources:
  NodejsDeploy:
    Type: AWS::EC2::Instance
    Properties:
      InstanceType: t2.micro
      ImageId: ami-0ec4aa492375c61f9
      KeyName: !Ref SSHKey
      SecurityGroups:
        - !Ref NodejsDeploySG
      UserData: 
        Fn::Base64:
          |
          #!/bin/bash 
          cd /home/ec2-user
          git clone https://github.com/madams47/CSC-SWE-Group3.git
          cd ./CSC-SWE-Group3/WorkItemManagementSystemApplication/
          npm install
          DEBUG=workitemmanagementsystemapplication:* npm start
          EOF
            
  NodejsDeploySG:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: for the app nodes that allow ssh, http 
      SecurityGroupIngress:
      - IpProtocol: tcp
        FromPort: '80'
        ToPort: '80'
        CidrIp: 0.0.0.0/0
      - IpProtocol: tcp
        FromPort: '22'
        ToPort: '22'
        CidrIp: 0.0.0.0/0
      - IpProtocol: tcp
        FromPort: '8000'
        ToPort: '8000'
        CidrIp: 0.0.0.0/0